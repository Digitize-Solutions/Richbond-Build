(()=>{var e={88:(e,r,t)=>{var n=t(17),a=n.join(__dirname,".."),s=n.join(a,"threekit"),o=n.join(a,"package.json"),i=n.join(a,"build_react"),u=n.join(a,"build_server"),c=n.join(a,"server"),p=n.join(c,"index.js"),d=n.join(a,"public"),f=n.join(d,"index.html"),l=n.join(a,"src"),v=n.join(l,"index.js"),m=n.join(l,"yarn.lock"),h=n.join(l,"node_modules");e.exports={threekitModule:s,appPackageJson:o,appBuild:i,serverBuild:u,serverRoot:c,serverIndexJs:p,appPublic:d,appIndexHtml:f,appSrc:l,appIndexJs:v,appYarnLock:m,nodeModules:h}},17:e=>{"use strict";e.exports=require("path")}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var s=r[n]={exports:{}};return e[n](s,s.exports,t),s.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};t.r(e),t.d(e,{addToOrder:()=>X,createOrder:()=>Q,deleteOrder:()=>re,editOrder:()=>ee,fetchOrders:()=>$,getOrder:()=>Z});var r={};t.r(r),t.d(r,{getTranslations:()=>te});var n={};t.r(n),t.d(n,{getConfigurations:()=>oe,getSavedConfiguration:()=>se,postConfiguration:()=>ae});var a={};t.r(a),t.d(a,{postFile:()=>ie});var s={};t.r(s),t.d(s,{postShareEmail:()=>pe,postShareSms:()=>de,postSnapshot:()=>ce});var o={};t.r(o),t.d(o,{getList:()=>fe});var i={};t.r(i),t.d(i,{fetchTranslations:()=>ve});var u={};t.r(u),t.d(u,{fetch:()=>ge,fetchAll:()=>xe,save:()=>be});var c={};t.r(c),t.d(c,{save:()=>we});var p={};t.r(p),t.d(p,{saveSnapshot:()=>ye,shareEmail:()=>ke,shareSms:()=>Oe});var d={};t.r(d),t.d(d,{getPricebooksList:()=>Pe});var f={};t.r(f),t.d(f,{createOrder:()=>Te,editOrder:()=>Ie,fetchOrders:()=>_e,getOrder:()=>je});const l=require("@babel/runtime/helpers/defineProperty");var v=t.n(l);const m=require("@babel/runtime/helpers/slicedToArray");var h=t.n(m);const b=require("@babel/runtime/helpers/asyncToGenerator");var g=t.n(b);const x=require("@babel/runtime/regenerator");var w=t.n(x);const y=require("express");var k=t.n(y);const O=require("cors");var P=t.n(O);const j=require("morgan");var _=t.n(j);const T=require("multer");var I=t.n(T);const S=require("dotenv");var E=t.n(S);const q=require("@babel/runtime/helpers/classCallCheck");var D=t.n(q);const R=require("@babel/runtime/helpers/createClass");var A=t.n(R);const C=require("joi");var N,U=t.n(C),M={minAllowed:"minAllowed",maxAllowed:"maxAllowed",minProximityToSelf:"minProximityToSelf",maxProximityToSelf:"maxProximityToSelf",minProximityToStart:"minProximityToStart",maxProximityToStart:"maxProximityToStart",minProximityToFinish:"minProximityToFinish",maxProximityToFinish:"maxProximityToFinish",minProximityToEnds:"minProximityToEnds",maxProximityToEnds:"maxProximityToEnds",positionsNotAllowed:"positionsNotAllowed",positionsAllowed:"positionsAllowed"},F=(Object.assign({maxItems:"maxItems"},M),Object.assign((N={title:"_title",description:"_description",thumbnail:"_thumbnail",sku:"_sku",filters:"_filters",tooltip:"_tooltip",price:"_price"},v()(N,"description","_description"),v()(N,"translate","_translate"),v()(N,"rotate","_rotate"),v()(N,"scale","_scale"),N),Object.entries(M).reduce((function(e,r){var t=h()(r,2),n=t[0],a=t[1];return Object.assign(e,v()({},n,"_".concat(a)))}),{})),U().object({authToken:U().string().guid({version:["uuidv4"]}).required(),orgId:U().string().required(),assetId:U().string(),threekitEnv:U().string(),serverUrl:U().string().allow("")})),L=new Function("try { return this === window; } catch(e) { return false; }");const G=new(function(){function e(){D()(this,e),this._authToken,this._orgId,this._assetId,this._threekitEnv="https://admin.threekit.com",this._isServerEnv=!L(),this._serverUrl="https://localhost:5000"}var r;return A()(e,[{key:"connect",value:(r=g()(w().mark((function e(r){var t,n,a,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=F.validate(r),a=n.value,!(s=n.error)){e.next=3;break}throw new Error(s);case 3:this._authToken=a.authToken,this._orgId=a.orgId,this._assetId=a.assetId,a.threekitEnv&&(this._threekitEnv="https://".concat(a.threekitEnv)),null!==(t=a.serverUrl)&&void 0!==t&&t.length&&(this._serverUrl=a.serverUrl);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getConnection",value:function(){if(!this._authToken)throw new Error("Connection has not been established");return{authToken:this._authToken,orgId:this._orgId,assetId:this._assetId,threekitEnv:this._threekitEnv,isServerEnv:this._isServerEnv,serverUrl:this._serverUrl}}}]),e}()),V=require("axios");var B=t.n(V);require("@babel/runtime/helpers/toConsumableArray"),require("@babel/runtime/helpers/typeof");var J=function(e){return e&&Object.keys(e).length?Object.entries(e).reduce((function(e,r,t){var n=h()(r,2),a=n[0],s=n[1];return t&&(e+="&"),void 0!==s&&(e+="".concat(a,"=").concat(s)),e}),"?"):""},z=function(e){var r;r=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var t=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(r.length),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return new Blob([n],{type:t})};function H(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var W=function(e){if(!e)throw new Error("Request missing");var r=Object.assign({method:"GET",params:{}},e),t=r.url,n=r.method,a=r.data,s=r.params,o=r.config,i=G.getConnection().serverUrl,u="".concat(i).concat(t),c=J(Object.assign({},s)),p="".concat(u).concat(c);return new Promise(function(){var e=g()(w().mark((function e(r){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=n,e.next="GET"===e.t0||"get"===e.t0?4:"POST"===e.t0||"post"===e.t0?8:"put"===e.t0||"PUT"===e.t0?12:"delete"===e.t0||"DELETE"===e.t0?16:19;break;case 4:return e.next=6,B().get(p,o);case 6:return t=e.sent,e.abrupt("break",20);case 8:return e.next=10,B().post(p,a,o);case 10:return t=e.sent,e.abrupt("break",20);case 12:return e.next=14,B().put(p,a,o);case 14:return t=e.sent,e.abrupt("break",20);case 16:return e.next=18,B().delete(p,o);case 18:t=e.sent;case 19:return e.abrupt("return",r([void 0,{message:"Unknown request method: ".concat(n)}]));case 20:r([t.data,void 0]),e.next=26;break;case 23:e.prev=23,e.t1=e.catch(0),r([void 0,e.t1]);case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(r){return e.apply(this,arguments)}}())},K=function(e){if(!e)throw new Error("Request missing");var r=Object.assign({method:"GET",params:{},includeOrgId:!1},"string"==typeof e?{url:e}:e),t=r.url,n=r.method,a=r.data,s=r.formData,o=r.params,i=r.config,u=r.includeOrgId,c=G.getConnection(),p=c.authToken,d=c.orgId,f=c.threekitEnv,l=c.isServerEnv,m="".concat(f).concat(t),h=J(Object.assign({},u?{orgId:d}:{},o)),b="".concat(m).concat(h),x=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?H(Object(t),!0).forEach((function(r){v()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},i);return l?x.headers=Object.assign({},x.headers||{},{authorization:"Bearer ".concat(p)}):b+="".concat(h.length?"&":"?","bearer_token=").concat(p),s&&(x.headers=Object.assign({},x.headers||{},{"content-type":"multipart/form-data; boundary=".concat(s._boundary)})),new Promise(function(){var e=g()(w().mark((function e(r){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=n,e.next="GET"===e.t0||"get"===e.t0?4:"POST"===e.t0||"post"===e.t0?8:"put"===e.t0||"PUT"===e.t0?12:"delete"===e.t0||"DELETE"===e.t0?16:19;break;case 4:return e.next=6,B().get(b,x);case 6:return t=e.sent,e.abrupt("break",20);case 8:return e.next=10,B().post(b,s||a,x);case 10:return t=e.sent,e.abrupt("break",20);case 12:return e.next=14,B().put(b,s||a,x);case 14:return t=e.sent,e.abrupt("break",20);case 16:return e.next=18,B().delete(b,x);case 18:t=e.sent;case 19:return e.abrupt("return",r([void 0,{message:"Unknown request method: ".concat(n)}]));case 20:r([t.data,void 0]),e.next=26;break;case 23:e.prev=23,e.t1=e.catch(0),r([void 0,e.t1]);case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(r){return e.apply(this,arguments)}}())},Y="/api/orders",Q=function(e){var r;return e||(r="Requires Order Data"),r?[void 0,{message:r}]:K({method:"POST",url:Y,data:e})},X=function(e,r){var t;return r||(t="Requires Order Data"),t?[void 0,{message:t}]:K({method:"PUT",url:"".concat(Y,"/").concat(e),data:r})},Z=function(e){return K({method:"GET",url:"".concat(Y,"/").concat(e)})},$=function(){return K({method:"GET",url:Y,includeOrgId:!0})},ee=function(e,r){var t;return e||(t="Requires an order ID / shortId"),r||(t="Requires updated cart data"),t?[void 0,{message:t}]:K({method:"PUT",url:Y,params:query})},re=function(e,r){var t;return e||(t="Requires an order ID / shortId"),r||(t="Requires updated cart data"),t?[void 0,{message:t}]:K({method:"PUT",url:Y,params:query})},te=function(){return K("".concat("/api/products","/translations"))},ne="/api/configurations",ae=function(e){var r;return e||(r="Requires Form Data"),r?[void 0,{message:r}]:K({method:"POST",url:ne,formData:e})},se=function(e){var r;return e||(r="Requires Configuration ID"),r?[void 0,{message:r}]:K("".concat(ne,"/").concat(e))},oe=function(){return K({method:"GET",url:"".concat(ne),includeOrgId:!0})},ie=function(e){var r;return e||(r="Requires Form Data"),r?[void 0,{message:r}]:K({method:"POST",url:"/api/files",formData:e})},ue="/api",ce=function(e){var r;return e||(r="Requires Form Data"),r?[void 0,{message:r}]:W({method:"POST",url:"".concat(ue,"/snapshot"),data:e})},pe=function(e){var r;return e||(r="Requires Email Data"),r?[void 0,{message:r}]:W({method:"POST",url:"".concat(ue,"/email"),data:e})},de=function(e){var r;return e||(r="Requires Sms Data"),r?[void 0,{message:r}]:W({method:"POST",url:"".concat(ue,"/sms"),data:e})},fe=function(){var e=G.getConnection().orgId;return K("/api/orgs/".concat(e,"/pricebooks"))};const le={orders:e,products:r,configurations:n,files:a,server:s,pricebook:o};var ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json";return new Promise(function(){var r=g()(w().mark((function r(t){var n,a,s,o,i,u,c;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,le.products.getTranslations();case 2:if(n=r.sent,a=h()(n,2),s=a[0],(o=a[1])&&t([void 0,o]),"csv"!==e.toLowerCase()){r.next=9;break}return r.abrupt("return",t([s,void 0]));case 9:i=s.replace(/"/g,"").split("\n").map((function(e){return e.split(",")})),u=i[0],c=i.reduce((function(e,r,t){return t?(e[r[0]]=r.reduce((function(e,r,t){return t?Object.assign(e,v()({},u[t],r.length?r:void 0)):e}),{}),e):e}),{}),t([c,void 0]);case 13:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())};const me=require("form-data");var he=t.n(me),be=function(){var e=g()(w().mark((function e(r){var t,n,a,s,o,i,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.assetId,n=r.customerId,a=r.configuration,s=r.metadata,o=r.productVersion,i=r.thumbnail,t||(u="Requires Asset Id"),a||(u="Requires a configuration"),!u){e.next=5;break}return e.abrupt("return",[void 0,{message:u}]);case 5:return(c=new(he())).append("productId",t),c.append("variant",JSON.stringify(a)),c.append("productVersion",o),s&&Object.keys(s)&&c.append("metadata",JSON.stringify(s)),n&&c.append("customerId",n),i&&c.append("thumbnail",i),e.next=14,le.configurations.postConfiguration(c);case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ge=function(e){var r;return e||(r="Requires Configuration Id"),r?resolve([void 0,{message:r}]):le.configurations.getSavedConfiguration(e)},xe=function(){return new Promise(function(){var e=g()(w().mark((function e(r){var t,n,a,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.configurations.getConfigurations();case 2:if(t=e.sent,n=h()(t,2),a=n[0],!(s=n[1])){e.next=8;break}return e.abrupt("return",r([void 0,s]));case 8:r([a.configurations,void 0]);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())},we=function(e){return new Promise(function(){var r=g()(w().mark((function r(t){var n,a,s,o,i,u;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e||(n="Requires Data"),!n){r.next=3;break}return r.abrupt("return",[void 0,{message:n}]);case 3:return(a=new(he())).append(e.fieldname,e.buffer,e.originalname),r.next=7,le.files.postFile(a);case 7:s=r.sent,o=h()(s,2),i=o[0],(u=o[1])&&t([void 0,u]),t([i,void 0]);case 13:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},ye=function(e,r){return new Promise(function(){var t=g()(w().mark((function t(n){var a,s,o,i,u,c,p,d;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e||(a="Requires Data"),!a){t.next=3;break}return t.abrupt("return",[void 0,{message:a}]);case 3:return s=new(he()),o="string"==typeof e?z(e):e,i=new File([o],r),s.append("files",i,r),t.next=9,le.server.postSnapshot(s);case 9:u=t.sent,c=h()(u,2),p=c[0],(d=c[1])&&n([void 0,d]),n([p,void 0]);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},ke=function(e){return new Promise(function(){var r=g()(w().mark((function r(t){var n,a,s,o,i;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e||(n="Requires Data"),!n){r.next=3;break}return r.abrupt("return",[void 0,{message:n}]);case 3:return r.next=5,le.server.postShareEmail(e);case 5:a=r.sent,s=h()(a,2),o=s[0],(i=s[1])&&t([void 0,i]),t([o,void 0]);case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},Oe=function(e){return new Promise(function(){var r=g()(w().mark((function r(t){var n,a,s,o,i;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e||(n="Requires Data"),!n){r.next=3;break}return r.abrupt("return",[void 0,{message:n}]);case 3:return r.next=5,le.server.postShareSms(e);case 5:a=r.sent,s=h()(a,2),o=s[0],(i=s[1])&&t([void 0,i]),t([o,void 0]);case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},Pe=function(){var e=g()(w().mark((function e(){var r,t,n,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.pricebook.getList();case 2:if(r=e.sent,t=h()(r,2),n=t[0],!(a=t[1])){e.next=8;break}return e.abrupt("return",[void 0,a]);case 8:return e.abrupt("return",[n.pricebooks,void 0]);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(){var e=g()(w().mark((function e(r){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=g()(w().mark((function e(t){var n,a,s,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.orders.getOrder(r);case 2:if(n=e.sent,a=h()(n,2),s=a[0],!(o=a[1])){e.next=8;break}return e.abrupt("return",[void 0,o]);case 8:t([s,void 0]);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_e=function(){var e=g()(w().mark((function e(r){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=g()(w().mark((function e(t){var n,a,s,o,i,u,c,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.orders.fetchOrders();case 2:if(n=e.sent,a=h()(n,2),s=a[0],!(o=a[1])){e.next=8;break}return e.abrupt("return",[void 0,o]);case 8:i=s.orders,r&&(u=h()(Object.entries(r)[0],2),c=u[0],p=u[1],i=i.filter((function(e){var r;return(null===(r=e.metadata)||void 0===r?void 0:r[c])===p}))),t([i,void 0]);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Te=function(){var e=g()(w().mark((function e(r){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=g()(w().mark((function e(t){var n,a,s,o,i,u,c,p,d,f,l,v;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=G.getConnection(),a=n.orgId,s=r.name,o=r.cart,i=r.metadata,u=r.platform,c=r.status,p={name:s,cart:o,orgId:a,platform:u||{},metadata:i||{},status:c||"List"},e.next=5,le.orders.createOrder(p);case 5:if(d=e.sent,f=h()(d,2),l=f[0],!(v=f[1])){e.next=11;break}return e.abrupt("return",[void 0,v]);case 11:t([l,void 0]);case 12:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ie=function(){var e=g()(w().mark((function e(r,t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=g()(w().mark((function e(n){var a,s,o,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&t){e.next=2;break}return e.abrupt("return",n([void 0,{message:"Missing Order Id"}]));case 2:return e.next=4,le.orders.addToOrder(r,t);case 4:if(a=e.sent,s=h()(a,2),o=s[0],!(i=s[1])){e.next=10;break}return e.abrupt("return",[void 0,i]);case 10:n([o,void 0]);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();const Se={products:i,configurations:u,files:c,server:p,price:d,orders:f};var Ee=t(88),qe=t.n(Ee);const De=require("twilio");var Re=t.n(De);const Ae=require("fs");var Ce=t.n(Ae);const Ne=require("puppeteer");var Ue=t.n(Ne);const Me=require("liquidjs");var Fe=t(17),Le=t.n(Fe),Ge=Le().join(__dirname,"assets"),Ve=Le().join(Ge,"template-01.json"),Be=new Me.Liquid;const Je=function(e,r){return new Promise(function(){var t=g()(w().mark((function t(n,a){var s,o,i,u,c,p,d,f,l,v;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=e.includes(".liquid")?e:"".concat(e,".liquid"),(o=Ce().readFileSync("".concat(Ge,"/").concat(s),"utf-8"))||a({message:"'".concat(e,"', template not found")}),(i=r)||(u=Ce().readFileSync(Ve,"utf-8"),i=JSON.parse(u)),c=Be.parse(o),t.next=9,Be.render(c,i);case 9:return p=t.sent,t.next=12,Ue().launch({args:["--no-sandbox","--disable-setuid-sandbox"]});case 12:return d=t.sent,t.next=15,d.newPage();case 15:return f=t.sent,t.next=18,f.setContent(p,{waitUntil:"networkidle0"});case 18:return t.next=20,f.emulateMediaType("print");case 20:return t.next=22,f.pdf({format:"A4",printBackground:!0});case 22:l=t.sent,v=Buffer.from(l,"binary"),d.close(),n(v),t.next=31;break;case 28:t.prev=28,t.t0=t.catch(0),a(t.t0);case 31:case"end":return t.stop()}}),t,null,[[0,28]])})));return function(e,r){return t.apply(this,arguments)}}())};function ze(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function He(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ze(Object(t),!0).forEach((function(r){v()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ze(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}E().config();var We=process.argv.slice(2),Ke=-1!==We.indexOf("--port")?We.indexOf("--port"):We.indexOf("-p"),Ye="MISSING_ENV_VAR".PORT||(Ke>0?We[Ke+1]:5e3),Qe="MISSING_ENV_VAR".EMAIL_TEMPLATE_ID,Xe="MISSING_ENV_VAR".EMAIL_API_KEY,Ze="MISSING_ENV_VAR".TWILIO_ACCOUNT_SID,$e="MISSING_ENV_VAR".TWILIO_AUTH_TOKEN,er="MISSING_ENV_VAR".TWILIO_FROM_PHONE_NUMBER,rr={authToken:"9f0baa88-09bd-43cb-82a8-7524baa235e6",orgId:"9f0baa88-09bd-43cb-82a8-7524baa235e6",assetId:"1b97c903-679c-46ea-b9b6-cba58bad3266",threekitEnv:"preview.threekit.com"};G.connect(rr);var tr=Ze&&$e?Re()(Ze,$e):void 0,nr=k()(),ar=I()({storage:I().memoryStorage()});nr.use(_()("tiny")),nr.use(k().json()),nr.use(P()()),nr.use(k().urlencoded()),nr.get("/api/health",(function(e,r){r.status(200).send({message:"server healthy!"})})),nr.post("/api/snapshot",ar.single("files"),function(){var e=g()(w().mark((function e(r,t){var n,a,s,o,i,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.file,e.next=3,Se.files.save(n);case 3:if(a=e.sent,s=h()(a,2),o=s[0],!(i=s[1])){e.next=11;break}return console.log(i.config),t.status(500).send(i),e.abrupt("return");case 11:u=He(He({},o.files[0]),{},{url:"https://".concat(rr.threekitEnv,"/api/files/").concat(o.files[0].id,"/content")}),t.status(200).send(u);case 13:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),nr.post("/api/email",function(){var e=g()(w().mark((function e(r,t){var n,a,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,a={template_id:n.templateId||Qe,from:{email:n.from||"asaeed@threekit.com"},personalizations:[{to:[{email:n.email}],dynamic_template_data:n}]},e.prev=2,e.next=5,B().post("https://api.sendgrid.com/v3/mail/send",a,{headers:{Authorization:"Bearer ".concat(Xe),"Content-Type":"application/json"}});case 5:s=e.sent,t.status(200).send(s.data),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),t.status(200).send(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(r,t){return e.apply(this,arguments)}}()),nr.post("/api/sms",function(){var e=g()(w().mark((function e(r,t){var n,a,s,o,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(tr){e.next=3;break}return t.status(500).json({message:"Twilio for sms share has not been setup"}),e.abrupt("return");case 3:if(n=r.body,a=n.to,s=n.message,a.length&&s.length){e.next=6;break}return e.abrupt("return",t.status(422).json({message:"incomplete request data"}));case 6:return o={from:er,to:a,body:s},e.prev=7,e.next=10,tr.messages.create(o);case 10:i=e.sent,t.status(200).send(i),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),console.log(e.t0),t.status(500).send();case 18:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(r,t){return e.apply(this,arguments)}}()),nr.get("/api/pdf/:template",function(){var e=g()(w().mark((function e(r,t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.params.template){e.next=2;break}return e.abrupt("return",t.status(422).send({message:"missing PDF template"}));case 2:return e.prev=2,e.next=5,Je(r.params.template,void 0);case 5:n=e.sent,t.set({"Content-type":"application/pdf"}),t.status(200).send(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0),t.status(422).send(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(r,t){return e.apply(this,arguments)}}()),nr.post("/api/pdf/:template",function(){var e=g()(w().mark((function e(r,t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.body){e.next=2;break}return e.abrupt("return",t.status(422).send());case 2:if(r.params.template){e.next=4;break}return e.abrupt("return",t.status(422).send({message:"missing PDF template"}));case 4:return e.prev=4,e.next=7,Je(r.params.template,r.body);case 7:n=e.sent,t.set(Object.assign({"Content-type":"application/pdf"},"true"===r.query.download?{"Content-Disposition":"attachment;filename=".concat(r.query.filename||"threekit-configuration.pdf")}:{})),t.end(n),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),console.log(e.t0),t.status(422).send(e.t0);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(r,t){return e.apply(this,arguments)}}()),nr.use(k().static(qe().appBuild)),nr.get("*",(function(e,r){r.sendFile(qe().appBuild)})),nr.listen(Ye,(function(){return console.log("listening on port: ",Ye)}))})()})();